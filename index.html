<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="LPBS NEWS - Sabse Aage, Sabse Tej. AI-powered latest news updates based on your location.">
    <meta name="theme-color" content="#006400"> <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>LPBS NEWS - Live Updates</title>
    
    <link rel="manifest" href="manifest.json">
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7398472528361759" crossorigin="anonymous"></script>

    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function(OneSignal) {
        await OneSignal.init({ appId: "a2089b57-b359-48e9-b4f5-9ba54f0f44c5" });
      });
    </script>
    
    <script src="https://pl28611418.effectivegatecpm.com/35/31/b2/3531b2e932ccfe8beb37c64390437ab8.js"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* CSS VARIABLES - THEME UPDATED TO DARK GREEN */
        :root { --primary: #006400; --whatsapp: #25D366; --bg: #000000; --card-bg: #111; --text: #e0e0e0; --border: #222; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; padding-bottom: 80px; overflow-x: hidden; }

        /* --- HEADER DESIGN (MOBILE OPTIMIZED) --- */
        header { background: var(--card-bg); padding: 0; position: sticky; top:0; z-index:999; border-bottom: 2px solid var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.4); }
        
        /* NEW TOP INFO BAR (Clock & Visitor) */
        .top-info-bar {
            background: #0a3d0a; /* Darker Green Background */
            color: #ccc;
            font-size: 10px;
            padding: 5px 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #222;
            font-weight: bold;
        }

        .top-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 10px 5px 10px; }
        
        .brand-box { position: relative; }
        .brand { font-size: 24px; font-weight: 900; margin: 0; color: white; line-height: 1; display: inline-block; }
        .slogan { font-size: 9px; color: #ffeb3b; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; display: block; margin-top: 2px; }
        
        .header-live-badge { 
            position: absolute; top: -5px; right: -30px; 
            background: red; color: white; font-size: 9px; font-weight: bold; 
            padding: 1px 4px; border-radius: 3px; animation: blink 1.5s infinite; 
        }

        .controls { display: flex; align-items: center; gap: 8px; }
        
        /* Translate Fix for Mobile */
        #google_translate_element { 
            width: 100px; height: 26px; overflow: hidden; border-radius: 4px; 
            background: #fff; border: 1px solid #555; 
        }
        .goog-te-combo { width: 100% !important; margin: 0 !important; font-size: 11px; font-weight: bold; }
        .goog-logo-link, .goog-te-banner-frame { display: none !important; } 

        /* Donate Button Mobile */
        .donate-icon-btn { color: #ffd700; font-size: 20px; animation: pulse 2s infinite; cursor: pointer; }

        /* --- NAVIGATION SCROLLER (APP FEEL) --- */
        .nav-scroller { 
            display: flex; gap: 10px; overflow-x: auto; padding: 8px 10px; 
            scrollbar-width: none; -ms-overflow-style: none;
            border-top: 1px solid #222; margin-top: 5px;
        }
        .nav-scroller::-webkit-scrollbar { display: none; }
        
        .nav-btn { 
            background: #222; color: #aaa; border: 1px solid #333; 
            padding: 6px 12px; cursor: pointer; white-space: nowrap; 
            font-size: 13px; font-weight: 600; border-radius: 20px; transition: 0.2s; 
        }
        .nav-btn.active { background: var(--primary); color: white; border-color: var(--primary); font-weight: 700; }

        /* --- TICKER (MARKET DATA) --- */
        .utility-bar { background: #0f0f0f; border-bottom: 1px solid #333; height: 35px; display: flex; align-items: center; position: relative; overflow: hidden; }
        .ticker-wrap { width: 100%; overflow: hidden; white-space: nowrap; }
        .ticker-move { display: inline-block; animation: ticker 30s linear infinite; padding-left: 100%; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }
        .market-item { color: #eee; font-size: 12px; font-weight: bold; margin-right: 25px; display: inline-flex; align-items: center; gap: 5px; }
        .market-up { color: #00e676; } .market-down { color: #ff4444; }

        /* --- LIVE SCORECARDS (AUTO SCROLL) --- */
        .live-score-container { 
            display: flex; gap: 10px; overflow-x: auto; padding: 15px 10px; 
            scrollbar-width: none; background: #000;
        }
        .score-card { 
            background: linear-gradient(145deg, #1a1a1a, #0d0d0d); 
            border: 1px solid #333; border-left: 4px solid var(--primary); 
            border-radius: 8px; padding: 12px; color: white;
            min-width: 260px; flex-shrink: 0; position: relative;
        }
        .live-dot { height: 8px; width: 8px; background: red; border-radius: 50%; display: inline-block; animation: blink 1s infinite; margin-right: 5px; }
        .score-text { font-family: monospace; font-size: 16px; color: #ffd700; margin-top: 5px; }

        /* --- NEWS GRID --- */
        .container { padding: 10px; max-width: 1200px; margin: 0 auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 15px; }
        
        /* Mobile Specific Grid Override */
        @media(max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
            .brand { font-size: 20px; }
            .nav-btn { font-size: 12px; padding: 5px 10px; }
            .card.featured { flex-direction: column; }
            .card.featured .media { width: 100%; height: 200px; }
            .card.featured .info { width: 100%; }
        }

        /* --- CARD DESIGN --- */
        .card { background: var(--card-bg); border-radius: 8px; overflow: hidden; border: 1px solid #222; display: flex; flex-direction: column; }
        .media { width: 100%; height: 200px; position: relative; background: #000; }
        .media img { width: 100%; height: 100%; object-fit: cover; opacity: 0.9; }
        .play-icon { position: absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:30px; color:white; background:rgba(0,0,0,0.6); width:50px; height:50px; display:flex; justify-content:center; align-items:center; border-radius:50%; border: 2px solid white; }
        
        .info { padding: 12px; }
        .loc-tag { background: #ffeb3b; color: #000; font-size: 10px; padding: 2px 5px; border-radius: 2px; font-weight: bold; text-transform: uppercase; }
        .title { font-size: 16px; font-weight: 700; margin: 8px 0; line-height: 1.4; color: #fff; }
        .meta { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; border-top: 1px solid #333; padding-top: 8px; font-size: 11px; color: #888; }
        
        .share-wa { background: var(--whatsapp); color: white; border: none; padding: 4px 10px; border-radius: 15px; font-size: 11px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 4px; }

        /* --- INSTALL APP BAR (Fixed Bottom) --- */
        #pwa-install-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; 
            background: #111; border-top: 1px solid var(--primary);
            padding: 10px 15px; display: none; align-items: center; justify-content: space-between;
            z-index: 2000; box-shadow: 0 -5px 15px rgba(0,0,0,0.8);
        }
        .pwa-text { color: white; font-size: 12px; }
        .pwa-btn { background: var(--primary); color: white; border: none; padding: 6px 15px; border-radius: 4px; font-weight: bold; font-size: 12px; }

        /* Donate Popup */
        .donate-popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 10px; z-index: 10000; border: 4px solid #ffd700; text-align: center; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        .close-donate { position: absolute; top: 5px; right: 10px; font-size: 20px; color: black; font-weight: bold; cursor: pointer; }

    </style>
</head>
<body>

    <header>
        <div class="top-info-bar">
            <div id="live-clock"><i class="fa-regular fa-clock"></i> Loading...</div>
            <div id="visitor-box"><i class="fa-solid fa-users"></i> Visits: <span id="visitor-count">...</span></div>
        </div>

        <div class="top-row">
            <div class="brand-box">
                <div style="position:relative;">
                    <h1 class="brand">LPBS <span style="color:var(--primary)">NEWS</span></h1>
                    <span class="header-live-badge">LIVE</span>
                </div>
                <span class="slogan">SABSE AAGE, SABSE TEJ</span>
            </div>

            <div class="controls">
                <i class="fa-solid fa-heart donate-icon-btn" onclick="toggleDonate()"></i>
                <div id="google_translate_element"></div>
                <a href="admin.html" style="color:#666; text-decoration:none;"><i class="fa-solid fa-user-shield"></i></a>
            </div>
        </div>

        <div class="nav-scroller">
            <button class="nav-btn active" onclick="filterNews('all')"><i class="fa-solid fa-newspaper"></i> Top News</button>
            <button class="nav-btn" onclick="filterNews('live')"><i class="fa-solid fa-tower-broadcast"></i> Live TV</button>
            <button class="nav-btn" onclick="filterNews('sports')"><i class="fa-solid fa-cricket-bat-ball"></i> Sports</button>
            <button class="nav-btn" onclick="filterNews('viral')"><i class="fa-solid fa-fire"></i> Viral</button>
            <button class="nav-btn" onclick="filterNews('tech')"><i class="fa-solid fa-microchip"></i> Tech</button>
            <button class="nav-btn" onclick="filterNews('movie')"><i class="fa-solid fa-film"></i> Movies</button>
        </div>
    </header>

    <div class="utility-bar">
        <div class="ticker-wrap">
            <div class="ticker-move" id="market-ticker">
                Loading Market Data...
            </div>
        </div>
    </div>

    <div id="live-scores-area" class="live-score-container">
        </div>

    <div class="container">
        <div id="news-grid" class="grid">
            <div style="text-align:center; padding:50px; color:#444;">
                <i class="fa-solid fa-circle-notch fa-spin fa-2x"></i><br>Finding News Near You...
            </div>
        </div>
    </div>

    <div id="pwa-install-bar">
        <div style="display:flex; align-items:center; gap:10px;">
            <i class="fa-brands fa-android" style="font-size:24px; color:#00e676;"></i>
            <div class="pwa-text"><strong>Install App</strong><br>Fast & Data Saver</div>
        </div>
        <button class="pwa-btn" onclick="installPWA()">INSTALL</button>
    </div>

    <div id="donate-pop" class="donate-popup">
        <span class="close-donate" onclick="toggleDonate()">&times;</span>
        <h3 style="margin:0 0 10px 0; color:black;">SUPPORT LPBS</h3>
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=Nrta1@icici&pn=LPBS%20News&cu=INR" alt="QR Code">
        <p style="color:black; font-weight:bold; margin:5px 0;">Nrta1@icici</p>
        <small style="color:#555;">Scan with GPay / PhonePe</small>
    </div>

    <script>
        // --- CONFIGURATION ---
        const SMARTLINK = "https://www.effectivegatecpm.com/uym16xq3jk?key=492c6ab2b2e619a347f8a0c6f22515e1";
        
        // --- TRANSLATE ---
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'bn,hi,en',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
                autoDisplay: false
            }, 'google_translate_element');
        }
    </script>
    <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <script>
        let allData = [];
        let userCity = "India";
        let deferredPrompt;

        // --- NEW: CLOCK & VISITOR LOGIC ---
        function updateClock() {
            const now = new Date();
            const options = { 
                timeZone: 'Asia/Kolkata', 
                weekday: 'short', year: 'numeric', month: 'short', day: 'numeric', 
                hour: '2-digit', minute: '2-digit', second: '2-digit' 
            };
            document.getElementById('live-clock').innerHTML = '<i class="fa-regular fa-clock"></i> ' + now.toLocaleString('en-IN', options);
        }
        setInterval(updateClock, 1000);

        function updateVisitorCount() {
            // LocalStorage ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶ì‡ßü‡¶æ ‡¶¨‡¶æ ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
            let count = localStorage.getItem('lpbs_visitors');
            if(!count) {
                count = 12540; // ‡¶´‡ßá‡¶ï ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶ü‡¶ø‡¶Ç ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ (‡¶Ø‡¶æ‡¶§‡ßá ‡¶∏‡¶æ‡¶á‡¶ü ‡¶™‡¶™‡ßÅ‡¶≤‡¶æ‡¶∞ ‡¶Æ‡¶®‡ßá ‡¶π‡ßü)
            } else {
                count = parseInt(count);
            }
            
            // ‡¶è‡¶á ‡¶∏‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡ßã (‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ö‡¶ü‡ßã ‡¶¨‡¶æ‡ßú‡¶æ‡¶¨‡ßã)
            // ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶∏‡¶ø‡¶Æ‡ßÅ‡¶≤‡ßá‡¶∂‡¶® (‡¶Æ‡¶æ‡¶ù‡ßá ‡¶Æ‡¶æ‡¶ù‡ßá ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü‡¶∞ ‡¶¨‡¶æ‡ßú‡¶¨‡ßá)
            document.getElementById('visitor-count').innerText = count.toLocaleString();
            
            setInterval(() => {
                // ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶Æ‡¶≤‡¶ø ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü‡¶∞ ‡¶¨‡¶æ‡ßú‡¶¨‡ßá
                if(Math.random() > 0.6) {
                    count += Math.floor(Math.random() * 3) + 1;
                    localStorage.setItem('lpbs_visitors', count);
                    document.getElementById('visitor-count').innerText = count.toLocaleString();
                }
            }, 3000);
        }
        // ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶≤‡ßá ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶¨‡¶æ‡ßú‡¶¨‡ßá
        let initCount = localStorage.getItem('lpbs_visitors');
        if(initCount) { localStorage.setItem('lpbs_visitors', parseInt(initCount) + 1); }
        else { localStorage.setItem('lpbs_visitors', 12541); }


        // --- 1. SMART MARKET SIMULATION (Gold & Stock) ---
        function updateMarketData() {
            const goldPrice = 76500 + Math.floor(Math.random() * 200);
            const silverPrice = 92000 + Math.floor(Math.random() * 500);
            const sensex = 72000 + Math.floor(Math.random() * 150 - 50);
            const nifty = 21800 + Math.floor(Math.random() * 50 - 20);

            const html = `
                <span class="market-item"><i class="fa-solid fa-coins" style="color:gold;"></i> GOLD (24K): ‚Çπ${goldPrice}</span>
                <span class="market-item"><i class="fa-solid fa-ring" style="color:silver;"></i> SILVER: ‚Çπ${silverPrice}</span>
                <span class="market-item">üìä SENSEX: ${sensex} <span class="${Math.random()>0.5?'market-up':'market-down'}">(${Math.random()>0.5?'+':'-'}120.5)</span></span>
                <span class="market-item">üìà NIFTY: ${nifty} <span class="market-up">(+45.2)</span></span>
            `;
            document.getElementById('market-ticker').innerHTML = html + html + html;
        }

        // --- 2. LIVE SPORTS SIMULATION ---
        let indRun = 210, indWicket = 3, overs = 35.2;
        let footTime = 72;
        
        function updateLiveScores() {
            const container = document.getElementById('live-scores-area');
            
            if(Math.random() > 0.7) { indRun += Math.floor(Math.random() * 4); } 
            if(Math.random() > 0.98) { indWicket += 1; } 
            
            footTime += 1; if(footTime > 90) footTime = 90;

            const html = `
                <div class="score-card">
                    <div style="display:flex; justify-content:space-between; font-size:10px; color:#aaa;">
                        <span><span class="live-dot"></span> LIVE CRICKET</span>
                        <span>World Cup</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-top:5px; font-weight:bold;">
                        <span>üáÆüá≥ IND vs üá¶üá∫ AUS</span>
                    </div>
                    <div class="score-text">${indRun}/${indWicket} <span style="font-size:12px; color:#ccc;">(${overs})</span></div>
                    <div style="font-size:10px; color:#00e676; margin-top:2px;">India need 45 runs to win</div>
                </div>

                <div class="score-card" style="border-left-color: #2979ff;">
                    <div style="display:flex; justify-content:space-between; font-size:10px; color:#aaa;">
                        <span><span class="live-dot" style="background:#2979ff;"></span> LIVE FOOTBALL</span>
                        <span>ISL 2026</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-top:5px; font-weight:bold;">
                        <span>Mohun Bagan vs East Bengal</span>
                    </div>
                    <div class="score-text">2 - 1</div>
                    <div style="font-size:10px; color:#ccc; margin-top:2px;">Time: ${footTime}' (2nd Half)</div>
                </div>

                <div class="score-card" style="border-left-color: #e91e63;">
                    <div style="display:flex; justify-content:space-between; font-size:10px; color:#aaa;">
                        <span>üì∞ BREAKING</span>
                        <span>Just Now</span>
                    </div>
                    <div style="margin-top:5px; font-size:13px; line-height:1.3;">
                        PM Modi announces new digital policy for rural India...
                    </div>
                </div>
            `;
            container.innerHTML = html;
        }

        // --- 3. NEWS LOADING SYSTEM ---
        async function loadSystem() {
            try {
                const ipRes = await fetch('https://ipapi.co/json/');
                const ipData = await ipRes.json();
                userCity = ipData.city || "India";
            } catch(e) { console.log("Loc failed"); }

            try {
                const res = await fetch('news_db.json?nocache=' + new Date().getTime());
                const data = await res.json();
                allData = data.news;
                
                const activeBtn = document.querySelector('.nav-btn.active');
                if(activeBtn) {
                    let cat = 'all';
                    const txt = activeBtn.innerText.toLowerCase();
                    if(txt.includes('live')) cat = 'live';
                    else if(txt.includes('sports')) cat = 'sports';
                    else if(txt.includes('viral')) cat = 'viral';
                    renderNews(cat);
                }
            } catch(e) { console.error("News Load Error", e); }
        }

        function renderNews(cat) {
            const grid = document.getElementById('news-grid');
            grid.innerHTML = '';
            
            let filtered = [];
            if (cat === 'all') filtered = [...allData];
            else if (cat === 'live') filtered = allData.filter(n => n.type === 'video'); 
            else filtered = allData.filter(n => n.category.toLowerCase().includes(cat) || n.title.toLowerCase().includes(cat));

            filtered.sort((a, b) => {
                const textA = (a.title + a.desc).toLowerCase();
                const textB = (b.title + b.desc).toLowerCase();
                return textB.includes(userCity.toLowerCase()) - textA.includes(userCity.toLowerCase());
            });

            if(filtered.length === 0) {
                grid.innerHTML = "<div style='padding:20px; text-align:center; color:#666;'>No updates in this category.</div>";
                return;
            }

            filtered.forEach(n => {
                const isVideo = n.type === 'video';
                const mediaHTML = isVideo 
                    ? `<div class="media" onclick="this.innerHTML='<iframe src=\\'${n.video_url}\\'></iframe>'"><div class="play-icon"><i class="fa-solid fa-play"></i></div><img src="${n.thumb}" loading="lazy"></div>`
                    : `<div class="media"><img src="${n.thumb}" loading="lazy"></div>`;

                const locBadge = (n.title + n.desc).toLowerCase().includes(userCity.toLowerCase()) 
                    ? `<span class="loc-tag"><i class="fa-solid fa-location-dot"></i> ${userCity}</span>` : '';

                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    ${mediaHTML}
                    <div class="info">
                        ${locBadge}
                        <div class="title">${n.title}</div>
                        <div class="meta">
                            <span>${n.time}</span>
                            <button class="share-wa" onclick="window.open('https://api.whatsapp.com/send?text=${encodeURIComponent(n.title + ' ' + SMARTLINK)}')">
                                <i class="fa-brands fa-whatsapp"></i> Share
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(div);
            });
        }

        window.filterNews = function(cat) {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            renderNews(cat);
        }

        function toggleDonate() {
            const d = document.getElementById('donate-pop');
            d.style.display = d.style.display === 'block' ? 'none' : 'block';
        }

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            if (!window.matchMedia('(display-mode: standalone)').matches) {
                document.getElementById('pwa-install-bar').style.display = 'flex';
            }
        });

        async function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    document.getElementById('pwa-install-bar').style.display = 'none';
                }
                deferredPrompt = null;
            }
        }

        // --- INIT ---
        updateClock();
        updateVisitorCount(); // Start Visitor Counter
        loadSystem();
        updateMarketData();
        updateLiveScores();
        setInterval(updateMarketData, 5000); 
        setInterval(updateLiveScores, 3000); 
        setInterval(loadSystem, 60000); 
    </script>
</body>
</html>
